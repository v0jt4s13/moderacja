{% extends "base.html" %}

{% block title %}Generuj obrazy z artykułu{% endblock %}
{% block header %}News → Image{% endblock %}

{% block content %}
<style>
  .nti-wrapper {
    max-width: 720px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }
  .nti-messages {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .nti-alert {
    border-radius: 10px;
    padding: 12px 16px;
    font-weight: 600;
  }
  .nti-alert.success {
    background: #163b22;
    color: #70f19d;
  }
  .nti-alert.danger {
    background: #3b1b1b;
    color: #f06f6f;
  }
  .nti-form {
    background: #11111170;
    padding: 24px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }
  .nti-form label {
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
  }
  .nti-form input,
  .nti-form select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #2a2a2a;
    background: #1b1b1b;
    color: #f3f3f3;
  }
  .nti-form button {
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #0d6efd;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
  }
  .nti-form button[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .nti-hint {
    font-size: 0.9rem;
    color: #cccccc;
  }
</style>

<div class="nti-wrapper">
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      <div class="nti-messages">
        {% for category, message in messages %}
          <div class="nti-alert {{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="nti-form">
    <form id="news-to-image-form" action="{{ url_for('news_to_image.generate_images') }}" method="post">
      {% set defaults = form_defaults or {'article_url': '', 'image_count': 2, 'engine': default_engine} %}
      {% set current_count = defaults.image_count %}
      {% set current_engine = defaults.engine %}

      <div>
        <label for="article_url">Adres URL artykułu</label>
        <input type="url" id="article_url" name="article_url" placeholder="https://..." value="{{ defaults.article_url }}" required>
        <p class="nti-hint">Treść zostanie pobrana i streści krótkim promptem.</p>
      </div>

      <div>
        <label for="image_count">Liczba obrazów (2-4)</label>
        <select id="image_count" name="image_count">
        {% for n in [2, 3, 4] %}
          <option value="{{ n }}" {% if n == current_count %}selected{% endif %}>{{ n }}</option>
        {% endfor %}
      </select>
      </div>

      <div>
        <label for="engine">Silnik generowania</label>
        <select id="engine" name="engine">
          {% for value, label in engines %}
            <option value="{{ value }}" {% if value == current_engine %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
        <p class="nti-hint">
          Midjourney i BlueWillow są przygotowane jako punkty rozszerzeń – dodaj własną implementację po konfiguracji webhooków.
        </p>
      </div>

      <button type="submit" id="generate-button">Generuj obrazy</button>
    </form>

    <div>
      <a class="button" href="{{ url_for('news_to_image.projects_list') }}">Zobacz listę projektów</a>
    </div>
  </div>
</div>

<script>
  (function () {
    const form = document.getElementById('news-to-image-form');
    if (!form) return;
    const submitBtn = form.querySelector('#generate-button');
    form.addEventListener('submit', function () {
      if (!submitBtn) return;
      submitBtn.disabled = true;
      submitBtn.dataset.originalText = submitBtn.textContent;
      submitBtn.textContent = 'Generuję...';
    });
  })();
</script>
{% endblock %}
